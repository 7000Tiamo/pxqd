<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åŸ¹è®­ç­¾åˆ°ç³»ç»Ÿ - äº¤äº’åŸå‹ v2</title>
    <style>
        :root {
            --primary-color: #3b82f6; /* Modern Blue */
            --primary-hover: #2563eb;
            --bg-color: #f8fafc;
            --card-bg: #ffffff;
            --text-main: #1e293b;
            --text-secondary: #64748b;
            --border-color: #e2e8f0;
            --success-color: #10b981;
            --warning-color: #f59e0b;
            --danger-color: #ef4444;
            --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
            --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            --radius: 0.5rem;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-main);
            line-height: 1.6;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* --- UI Components --- */
        
        /* Buttons */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 0.5rem 1rem;
            border-radius: var(--radius);
            font-weight: 500;
            cursor: pointer;
            border: 1px solid transparent;
            transition: all 0.2s ease;
            font-size: 0.875rem;
            gap: 0.5rem;
        }
        .btn:active { transform: translateY(1px); }

        .btn-primary { background-color: var(--primary-color); color: white; }
        .btn-primary:hover { background-color: var(--primary-hover); box-shadow: 0 2px 4px rgba(59, 130, 246, 0.3); }

        .btn-secondary { background-color: white; border-color: var(--border-color); color: var(--text-main); }
        .btn-secondary:hover { background-color: #f1f5f9; border-color: #cbd5e1; }

        .btn-danger { background-color: #fee2e2; color: var(--danger-color); }
        .btn-danger:hover { background-color: #fecaca; }

        .btn-sm { padding: 0.25rem 0.5rem; font-size: 0.75rem; }

        /* Inputs */
        .input {
            display: block;
            width: 100%;
            padding: 0.625rem;
            border-radius: var(--radius);
            border: 1px solid var(--border-color);
            background-color: #fff;
            transition: border-color 0.2s;
        }
        .input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        /* Cards */
        .card {
            background-color: var(--card-bg);
            border-radius: var(--radius);
            box-shadow: var(--shadow-sm);
            padding: 1.5rem;
            border: 1px solid var(--border-color);
            transition: box-shadow 0.2s;
        }
        .card:hover { box-shadow: var(--shadow-md); }

        /* Tables */
        .table-container {
            overflow-x: auto;
            border-radius: var(--radius);
            border: 1px solid var(--border-color);
        }
        .table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.875rem;
            background: white;
        }
        .table th {
            background-color: #f8fafc;
            font-weight: 600;
            text-align: left;
            padding: 0.75rem 1rem;
            border-bottom: 1px solid var(--border-color);
            color: var(--text-secondary);
        }
        .table td {
            padding: 0.75rem 1rem;
            border-bottom: 1px solid var(--border-color);
        }
        .table tr:last-child td { border-bottom: none; }
        .table tr:hover td { background-color: #f8fafc; }

        /* Layout Helpers */
        .hidden { display: none !important; }
        .flex { display: flex; }
        .flex-col { flex-direction: column; }
        .items-center { align-items: center; }
        .justify-between { justify-content: space-between; }
        .justify-center { justify-content: center; }
        .justify-end { justify-content: flex-end; }
        .gap-2 { gap: 0.5rem; }
        .gap-4 { gap: 1rem; }
        .mb-4 { margin-bottom: 1rem; }
        .mb-6 { margin-bottom: 1.5rem; }
        .mt-4 { margin-top: 1rem; }
        .w-full { width: 100%; }
        
        .text-xl { font-size: 1.25rem; font-weight: 700; color: var(--text-main); }
        .text-lg { font-size: 1.125rem; font-weight: 600; }
        .text-sm { font-size: 0.875rem; }
        .text-secondary { color: var(--text-secondary); }
        .text-center { text-align: center; }
        .font-bold { font-weight: 700; }
        
        /* Grid */
        .grid-2 { display: grid; grid-template-columns: repeat(2, 1fr); gap: 1.5rem; }
        .grid-4 { display: grid; grid-template-columns: repeat(4, 1fr); gap: 1.5rem; }
        @media (max-width: 768px) {
            .grid-2, .grid-4 { grid-template-columns: 1fr; }
        }

        /* Navigation */
        header {
            background-color: #ffffff;
            border-bottom: 1px solid var(--border-color);
            padding: 0 2rem;
            height: 64px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: sticky;
            top: 0;
            z-index: 50;
            box-shadow: var(--shadow-sm);
        }
        .nav-links { display: flex; gap: 2rem; height: 100%; }
        .nav-link {
            display: flex;
            align-items: center;
            color: var(--text-secondary);
            text-decoration: none;
            font-size: 0.9rem;
            font-weight: 500;
            height: 100%;
            border-bottom: 2px solid transparent;
            cursor: pointer;
            transition: all 0.2s;
        }
        .nav-link:hover { color: var(--primary-color); }
        .nav-link.active { color: var(--primary-color); border-bottom-color: var(--primary-color); }

        /* Tags */
        .tag {
            padding: 0.25rem 0.6rem;
            border-radius: 999px;
            font-size: 0.75rem;
            font-weight: 600;
        }
        .tag-blue { background: #eff6ff; color: #1d4ed8; }
        .tag-green { background: #ecfdf5; color: #047857; }
        .tag-yellow { background: #fffbeb; color: #b45309; }
        .tag-gray { background: #f1f5f9; color: #475569; }

        /* Toast Notification */
        #toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 9999;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .toast {
            background: white;
            padding: 1rem 1.5rem;
            border-radius: var(--radius);
            box-shadow: var(--shadow-md);
            border-left: 4px solid var(--primary-color);
            animation: slideIn 0.3s ease;
            display: flex;
            align-items: center;
            min-width: 300px;
        }
        .toast.success { border-left-color: var(--success-color); }
        .toast.error { border-left-color: var(--danger-color); }
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        /* Modals */
        .modal-overlay {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 100;
            backdrop-filter: blur(2px);
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.2s;
        }
        .modal-overlay.active { opacity: 1; pointer-events: auto; }
        .modal {
            background: white;
            padding: 2rem;
            border-radius: 0.75rem;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
            transform: scale(0.95);
            transition: transform 0.2s;
        }
        .modal-overlay.active .modal { transform: scale(1); }
        .modal-header { font-size: 1.25rem; font-weight: 700; margin-bottom: 1.5rem; }
        .modal-footer { margin-top: 2rem; display: flex; justify-content: flex-end; gap: 1rem; }

        /* Specific Views */
        .main-container { padding: 2rem; max-width: 1280px; margin: 0 auto; width: 100%; flex: 1; }
        
        /* Mobile Simulator */
        .mobile-frame {
            width: 360px;
            height: 700px;
            background: white;
            border: 12px solid #2d2d2d;
            border-radius: 40px;
            margin: 0 auto;
            position: relative;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
        }
        .mobile-status-bar { height: 24px; background: #2d2d2d; width: 100%; }
        .mobile-header {
            background: var(--primary-color);
            color: white;
            padding: 1rem;
            text-align: center;
            font-weight: 600;
        }
        .mobile-content {
            flex: 1;
            padding: 1.5rem;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            background: #f8fafc;
        }

        /* Chat */
        .chat-box {
            border: 1px solid var(--border-color);
            border-radius: var(--radius);
            height: 500px;
            display: flex;
            flex-direction: column;
            background: white;
        }
        .chat-msgs { flex: 1; padding: 1.5rem; overflow-y: auto; background: #f1f5f9; }
        .chat-input { padding: 1rem; border-top: 1px solid var(--border-color); display: flex; gap: 0.5rem; background: white; }
        .msg {
            max-width: 80%;
            padding: 0.75rem 1rem;
            border-radius: 1rem;
            margin-bottom: 1rem;
            font-size: 0.9rem;
            line-height: 1.4;
        }
        .msg.bot { background: white; border-bottom-left-radius: 0; align-self: flex-start; box-shadow: var(--shadow-sm); }
        .msg.user { background: var(--primary-color); color: white; border-bottom-right-radius: 0; align-self: flex-end; margin-left: auto; }

    </style>
</head>
<body>

    <!-- Toast Container -->
    <div id="toast-container"></div>

    <!-- Header -->
    <header id="main-header" class="hidden">
        <div class="flex items-center gap-4">
            <div class="flex items-center justify-center bg-blue-100 text-blue-600 w-8 h-8 rounded-full font-bold">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M9 11l3 3L22 4"/><path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"/>
                </svg>
            </div>
            <h1 class="text-lg">ä¼ä¸šåŸ¹è®­ç­¾åˆ°</h1>
        </div>

        <nav class="nav-links" id="admin-nav">
            <a onclick="router.go('admin-home')" class="nav-link">æ€»è§ˆ</a>
            <a onclick="router.go('training-mgmt')" class="nav-link">åŸ¹è®­ç®¡ç†</a>
            <a onclick="router.go('user-mgmt')" class="nav-link">ç”¨æˆ·ç®¡ç†</a>
            <a onclick="router.go('stats')" class="nav-link">æ•°æ®ç»Ÿè®¡</a>
            <a onclick="router.go('rag')" class="nav-link">æ™ºèƒ½åŠ©æ‰‹</a>
        </nav>

        <nav class="nav-links hidden" id="employee-nav">
            <a onclick="router.go('employee-home')" class="nav-link">æˆ‘çš„ä¸»é¡µ</a>
            <a onclick="router.go('rag')" class="nav-link">æ™ºèƒ½åŠ©æ‰‹</a>
        </nav>

        <div class="flex items-center gap-4">
            <div class="flex flex-col items-end">
                <span id="user-name-display" class="text-sm font-bold text-main">ç®¡ç†å‘˜</span>
                <span id="user-role-display" class="text-xs text-secondary">Admin</span>
            </div>
            <button onclick="auth.logout()" class="btn btn-secondary btn-sm">é€€å‡º</button>
        </div>
    </header>

    <div class="main-container">
        
        <!-- View: Login -->
        <div id="view-login">
            <div class="flex items-center justify-center" style="height: 80vh;">
                <div class="card" style="width: 400px; padding: 2.5rem;">
                    <h2 class="text-xl text-center mb-6">æ¬¢è¿ç™»å½•</h2>
                    <div class="mb-4">
                        <label class="text-sm font-bold mb-1 block">è´¦å·</label>
                        <input type="text" id="login-id" class="input" placeholder="admin æˆ– emp001" value="admin">
                    </div>
                    <div class="mb-6">
                        <label class="text-sm font-bold mb-1 block">å¯†ç </label>
                        <input type="password" class="input" value="123456">
                    </div>
                    <button onclick="auth.login()" class="btn btn-primary w-full" style="padding: 0.75rem;">ç™» å½•</button>
                    <div class="mt-4 text-center text-sm text-secondary">
                        <p>ç®¡ç†å‘˜: admin / å‘˜å·¥: emp001</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- View: Admin Home -->
        <div id="view-admin-home" class="hidden">
            <h2 class="text-xl mb-6">ç®¡ç†æ€»è§ˆ</h2>
            <div class="grid-4 mb-8">
                <div class="card flex flex-col items-center">
                    <span class="text-3xl font-bold text-primary mb-1">12</span>
                    <span class="text-sm text-secondary">æœ¬æœˆåŸ¹è®­åœºæ¬¡</span>
                </div>
                <div class="card flex flex-col items-center">
                    <span class="text-3xl font-bold text-success mb-1">348</span>
                    <span class="text-sm text-secondary">ç´¯è®¡æŠ¥åäººæ•°</span>
                </div>
                <div class="card flex flex-col items-center">
                    <span class="text-3xl font-bold text-warning mb-1">92%</span>
                    <span class="text-sm text-secondary">å¹³å‡ç­¾åˆ°ç‡</span>
                </div>
                <div class="card flex flex-col items-center">
                    <span class="text-3xl font-bold text-purple-600 mb-1">4.8</span>
                    <span class="text-sm text-secondary">è¯¾ç¨‹å¹³å‡è¯„åˆ†</span>
                </div>
            </div>
            
            <div class="grid-2" style="grid-template-columns: 2fr 1fr;">
                <div class="card">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg">æœ€è¿‘å‘å¸ƒçš„åŸ¹è®­</h3>
                        <button onclick="router.go('training-mgmt')" class="btn btn-secondary btn-sm">æŸ¥çœ‹å…¨éƒ¨</button>
                    </div>
                    <div class="table-container">
                        <table class="table">
                            <thead><tr><th>åŸ¹è®­åç§°</th><th>æ—¶é—´</th><th>çŠ¶æ€</th></tr></thead>
                            <tbody id="home-recent-list"></tbody>
                        </table>
                    </div>
                </div>
                <div class="card">
                    <h3 class="text-lg mb-4">å¿«æ·æ“ä½œ</h3>
                    <div class="flex flex-col gap-3">
                        <button onclick="router.go('training-form')" class="btn btn-primary w-full justify-center">å‘å¸ƒæ–°åŸ¹è®­</button>
                        <button onclick="router.go('user-mgmt')" class="btn btn-secondary w-full justify-center">æ·»åŠ æ–°å‘˜å·¥</button>
                        <button onclick="router.go('stats')" class="btn btn-secondary w-full justify-center">ä¸‹è½½æœ¬æœˆæŠ¥è¡¨</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- View: Employee Home -->
        <div id="view-employee-home" class="hidden">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-xl">æˆ‘çš„åŸ¹è®­çœ‹æ¿</h2>
                <button onclick="router.go('mobile-signin')" class="btn btn-primary">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 7V5a2 2 0 0 1 2-2h2"/><path d="M17 3h2a2 2 0 0 1 2 2v2"/><path d="M21 17v2a2 2 0 0 1-2 2h-2"/><path d="M7 21H5a2 2 0 0 1-2-2v-2"/></svg>
                    æ‰«ç ç­¾åˆ°
                </button>
            </div>
            
            <div class="card mb-6">
                <h3 class="text-lg mb-4 border-b pb-2">å¾…å‚åŠ åŸ¹è®­</h3>
                <div id="emp-todo-list" class="flex flex-col gap-4"></div>
            </div>

            <div class="card">
                <h3 class="text-lg mb-4 border-b pb-2">æœ€æ–°å¯æŠ¥å</h3>
                <div id="emp-available-list" class="grid-2"></div>
            </div>
        </div>

        <!-- View: User Management -->
        <div id="view-user-mgmt" class="hidden">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-xl">ç”¨æˆ·ç®¡ç†</h2>
                <button onclick="app.openUserModal()" class="btn btn-primary">+ æ–°å»ºç”¨æˆ·</button>
            </div>
            <div class="card">
                <div class="table-container">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>å§“å</th>
                                <th>å·¥å·</th>
                                <th>éƒ¨é—¨</th>
                                <th>çŠ¶æ€</th>
                                <th style="text-align: right;">æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody id="user-table-body"></tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- View: Training Management -->
        <div id="view-training-mgmt" class="hidden">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-xl">åŸ¹è®­ç®¡ç†</h2>
                <button onclick="router.go('training-form')" class="btn btn-primary">+ å‘å¸ƒåŸ¹è®­</button>
            </div>
            <div class="card">
                <div class="table-container">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>åŸ¹è®­åç§°</th>
                                <th>æ—¶é—´</th>
                                <th>è®²å¸ˆ</th>
                                <th>æŠ¥å/é™é¢</th>
                                <th>çŠ¶æ€</th>
                                <th style="text-align: right;">æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody id="training-table-body"></tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- View: Training Form -->
        <div id="view-training-form" class="hidden">
            <div class="flex items-center gap-4 mb-6">
                <button onclick="router.back()" class="btn btn-secondary">â† è¿”å›</button>
                <h2 class="text-xl">å‘å¸ƒ/ç¼–è¾‘åŸ¹è®­</h2>
            </div>
            <div class="card max-w-4xl mx-auto">
                <div class="grid-2">
                    <div>
                        <div class="mb-4">
                            <label class="text-sm font-bold mb-1 block">åŸ¹è®­åç§°</label>
                            <input type="text" id="tf-title" class="input" placeholder="ä¾‹å¦‚ï¼š2025å¹´ç¬¬ä¸€å­£åº¦å®‰å…¨åŸ¹è®­">
                        </div>
                        <div class="mb-4">
                            <label class="text-sm font-bold mb-1 block">è®²å¸ˆ</label>
                            <input type="text" id="tf-trainer" class="input" placeholder="è®²å¸ˆå§“å">
                        </div>
                        <div class="mb-4">
                            <label class="text-sm font-bold mb-1 block">åœ°ç‚¹</label>
                            <input type="text" id="tf-location" class="input" placeholder="ä¾‹å¦‚ï¼š301ä¼šè®®å®¤">
                        </div>
                        <div class="grid-2 gap-2">
                            <div class="mb-4">
                                <label class="text-sm font-bold mb-1 block">å¼€å§‹æ—¶é—´</label>
                                <input type="datetime-local" id="tf-start" class="input">
                            </div>
                            <div class="mb-4">
                                <label class="text-sm font-bold mb-1 block">ç»“æŸæ—¶é—´</label>
                                <input type="datetime-local" id="tf-end" class="input">
                            </div>
                        </div>
                    </div>
                    <div>
                        <div class="mb-4">
                            <label class="text-sm font-bold mb-1 block">åŸ¹è®­ä»‹ç»</label>
                            <textarea id="tf-desc" class="input" rows="6" placeholder="è¯·è¾“å…¥åŸ¹è®­è¯¦ç»†ä»‹ç»..."></textarea>
                        </div>
                        <div class="mb-4">
                            <label class="text-sm font-bold mb-1 block">äººæ•°é™åˆ¶ (0ä¸ºä¸é™)</label>
                            <input type="number" id="tf-limit" class="input" value="50">
                        </div>
                        <div class="p-4 bg-blue-50 rounded-lg border border-blue-100">
                            <h4 class="font-bold text-sm mb-2 text-blue-800">ç­¾åˆ°è§„åˆ™</h4>
                            <label class="flex items-center gap-2 mb-2 cursor-pointer">
                                <input type="checkbox" checked class="accent-blue-600"> éœ€è¦æŠ¥å
                            </label>
                            <div class="flex items-center gap-2">
                                <span class="text-sm">è¿Ÿåˆ°é˜ˆå€¼:</span>
                                <input type="number" class="input" style="width: 80px; padding: 0.25rem;" value="15">
                                <span class="text-sm">åˆ†é’Ÿ</span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="flex justify-end gap-3 mt-6 border-t pt-4">
                    <button onclick="router.back()" class="btn btn-secondary">å–æ¶ˆ</button>
                    <button onclick="app.saveTraining()" class="btn btn-primary px-6">å‘å¸ƒåŸ¹è®­</button>
                </div>
            </div>
        </div>

        <!-- View: Training Detail -->
        <div id="view-training-detail" class="hidden">
            <div class="flex items-center gap-4 mb-6">
                <button onclick="router.back()" class="btn btn-secondary">â† è¿”å›</button>
                <h2 class="text-xl">åŸ¹è®­è¯¦æƒ…</h2>
            </div>
            
            <div class="grid-2 mb-6" style="grid-template-columns: 2fr 1fr;">
                <div class="card">
                    <div class="flex justify-between items-start mb-4">
                        <div>
                            <h3 class="text-xl font-bold mb-2" id="td-title">åŸ¹è®­åç§°</h3>
                            <div class="flex gap-4 text-sm text-secondary">
                                <span>ğŸ‘¤ <span id="td-trainer">è®²å¸ˆ</span></span>
                                <span>ğŸ“ <span id="td-location">åœ°ç‚¹</span></span>
                                <span>â° <span id="td-time">æ—¶é—´</span></span>
                            </div>
                        </div>
                        <span id="td-status" class="tag tag-blue">çŠ¶æ€</span>
                    </div>
                    <p class="text-gray-600 text-sm mb-6" id="td-desc">åŸ¹è®­ä»‹ç»...</p>
                    <div class="flex gap-3">
                        <button class="btn btn-primary">ç”Ÿæˆç­¾åˆ°äºŒç»´ç </button>
                        <button class="btn btn-secondary">ç¼–è¾‘åŸ¹è®­</button>
                        <button class="btn btn-secondary">å‘å¸ƒå…¬å‘Š</button>
                    </div>
                </div>
                
                <div class="grid-2 gap-4" style="grid-template-columns: 1fr 1fr;">
                    <div class="card flex flex-col items-center justify-center p-4">
                        <span class="text-2xl font-bold text-blue-600" id="td-stat-applied">0</span>
                        <span class="text-xs text-secondary">å·²æŠ¥å</span>
                    </div>
                    <div class="card flex flex-col items-center justify-center p-4">
                        <span class="text-2xl font-bold text-green-600" id="td-stat-signed">0</span>
                        <span class="text-xs text-secondary">å·²ç­¾åˆ°</span>
                    </div>
                    <div class="card flex flex-col items-center justify-center p-4">
                        <span class="text-2xl font-bold text-orange-500" id="td-stat-late">0</span>
                        <span class="text-xs text-secondary">è¿Ÿåˆ°</span>
                    </div>
                    <div class="card flex flex-col items-center justify-center p-4">
                        <span class="text-2xl font-bold text-gray-500" id="td-stat-rate">0%</span>
                        <span class="text-xs text-secondary">ç­¾åˆ°ç‡</span>
                    </div>
                </div>
            </div>

            <div class="card">
                <h3 class="text-lg mb-4">å­¦å‘˜åå•</h3>
                <div class="table-container">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>å§“å</th>
                                <th>éƒ¨é—¨</th>
                                <th>æŠ¥åæ—¶é—´</th>
                                <th>ç­¾åˆ°æ—¶é—´</th>
                                <th>çŠ¶æ€</th>
                            </tr>
                        </thead>
                        <tbody id="td-student-list">
                            <!-- Populated by JS -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- View: Statistics -->
        <div id="view-stats" class="hidden">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-xl">æ•°æ®ç»Ÿè®¡</h2>
                <button class="btn btn-secondary" onclick="ui.toast('æŠ¥è¡¨å¯¼å‡ºä¸­...')">ğŸ“¥ å¯¼å‡ºExcel</button>
            </div>

            <div class="grid-4 mb-6">
                <div class="card p-4">
                    <div class="text-sm text-secondary mb-1">æœ¬æœˆå¹³å‡å‚ä¸ç‡</div>
                    <div class="text-2xl font-bold text-blue-600">88.5%</div>
                    <div class="text-xs text-green-500">â†‘ 2.3% è¾ƒä¸Šæœˆ</div>
                </div>
                <div class="card p-4">
                    <div class="text-sm text-secondary mb-1">ç´¯è®¡åŸ¹è®­æ—¶é•¿</div>
                    <div class="text-2xl font-bold text-purple-600">126h</div>
                </div>
                <div class="card p-4">
                    <div class="text-sm text-secondary mb-1">äººå‡åŸ¹è®­åœºæ¬¡</div>
                    <div class="text-2xl font-bold text-orange-500">3.2</div>
                </div>
                <div class="card p-4">
                    <div class="text-sm text-secondary mb-1">æ€»æŠ•å…¥é¢„ç®—</div>
                    <div class="text-2xl font-bold text-gray-700">Â¥12,400</div>
                </div>
            </div>

            <div class="grid-2 mb-6" style="grid-template-columns: 2fr 1fr;">
                <div class="card">
                    <h3 class="text-lg mb-4">å„éƒ¨é—¨å‚ä¸æƒ…å†µ</h3>
                    <div class="space-y-4">
                        <div>
                            <div class="flex justify-between text-sm mb-1"><span>ç ”å‘éƒ¨</span><span>92%</span></div>
                            <div class="w-full bg-gray-100 rounded-full h-2.5"><div class="bg-blue-600 h-2.5 rounded-full" style="width: 92%"></div></div>
                        </div>
                        <div>
                            <div class="flex justify-between text-sm mb-1"><span>å¸‚åœºéƒ¨</span><span>78%</span></div>
                            <div class="w-full bg-gray-100 rounded-full h-2.5"><div class="bg-blue-600 h-2.5 rounded-full" style="width: 78%"></div></div>
                        </div>
                        <div>
                            <div class="flex justify-between text-sm mb-1"><span>äººäº‹éƒ¨</span><span>95%</span></div>
                            <div class="w-full bg-gray-100 rounded-full h-2.5"><div class="bg-blue-600 h-2.5 rounded-full" style="width: 95%"></div></div>
                        </div>
                        <div>
                            <div class="flex justify-between text-sm mb-1"><span>è´¢åŠ¡éƒ¨</span><span>85%</span></div>
                            <div class="w-full bg-gray-100 rounded-full h-2.5"><div class="bg-blue-600 h-2.5 rounded-full" style="width: 85%"></div></div>
                        </div>
                    </div>
                </div>
                <div class="card flex flex-col items-center justify-center">
                    <h3 class="text-lg mb-4 w-full text-left">ç­¾åˆ°çŠ¶æ€åˆ†å¸ƒ</h3>
                    <div class="relative w-40 h-40 rounded-full" style="background: conic-gradient(#10b981 0% 70%, #f59e0b 70% 85%, #ef4444 85% 100%);">
                        <div class="absolute inset-4 bg-white rounded-full flex items-center justify-center flex-col">
                            <span class="text-2xl font-bold">348</span>
                            <span class="text-xs text-secondary">æ€»äººæ¬¡</span>
                        </div>
                    </div>
                    <div class="flex gap-4 mt-6 text-xs">
                        <div class="flex items-center gap-1"><span class="w-3 h-3 bg-green-500 rounded-full"></span>æ­£å¸¸ 70%</div>
                        <div class="flex items-center gap-1"><span class="w-3 h-3 bg-yellow-500 rounded-full"></span>è¿Ÿåˆ° 15%</div>
                        <div class="flex items-center gap-1"><span class="w-3 h-3 bg-red-500 rounded-full"></span>ç¼ºå‹¤ 15%</div>
                    </div>
                </div>
            </div>

            <div class="card">
                <h3 class="text-lg mb-4">è¯¦ç»†æ•°æ®è¡¨</h3>
                <div class="table-container">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>åŸ¹è®­åç§°</th>
                                <th>éƒ¨é—¨</th>
                                <th>åº”åˆ°</th>
                                <th>å®åˆ°</th>
                                <th>å‚ä¸ç‡</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>2025å¹´Q1å…¨å‘˜å®‰å…¨æ„è¯†åŸ¹è®­</td>
                                <td>ç ”å‘éƒ¨</td>
                                <td>50</td>
                                <td>48</td>
                                <td>96%</td>
                            </tr>
                            <tr>
                                <td>2025å¹´Q1å…¨å‘˜å®‰å…¨æ„è¯†åŸ¹è®­</td>
                                <td>å¸‚åœºéƒ¨</td>
                                <td>30</td>
                                <td>25</td>
                                <td>83%</td>
                            </tr>
                            <tr>
                                <td>é«˜çº§æ¶æ„è®¾è®¡å®æˆ˜</td>
                                <td>ç ”å‘éƒ¨</td>
                                <td>20</td>
                                <td>20</td>
                                <td>100%</td>
                            </tr>
                            <tr>
                                <td>å•†åŠ¡ç¤¼ä»ªä¸æ²Ÿé€š</td>
                                <td>å¸‚åœºéƒ¨</td>
                                <td>40</td>
                                <td>35</td>
                                <td>87.5%</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- View: Mobile Sign In -->
        <div id="view-mobile-signin" class="hidden">
            <div class="flex justify-center py-8 bg-gray-100 min-h-screen">
                <div class="mobile-frame">
                    <div class="mobile-status-bar"></div>
                    <div class="mobile-header">
                        <span>ç­¾åˆ°åŠ©æ‰‹</span>
                    </div>
                    <div class="mobile-content relative">
                        <!-- Step 1: Scan -->
                        <div id="ms-step-scan" class="flex flex-col items-center justify-center h-full">
                            <div class="w-64 h-64 border-4 border-dashed border-gray-300 rounded-xl flex items-center justify-center mb-8 bg-gray-50">
                                <span class="text-gray-400">ç›¸æœºå–æ™¯æ¡†</span>
                            </div>
                            <button onclick="app.mobileScanSuccess()" class="btn btn-primary w-full py-3 mb-3">
                                æ¨¡æ‹Ÿï¼šè¯†åˆ«åˆ°äºŒç»´ç 
                            </button>
                            <button onclick="router.back()" class="btn btn-secondary w-full">é€€å‡º</button>
                        </div>

                        <!-- Step 2: Confirm -->
                        <div id="ms-step-confirm" class="hidden flex flex-col h-full">
                            <div class="text-center mb-8 mt-4">
                                <h3 class="text-xl font-bold mb-2 text-gray-800" id="ms-title">åŸ¹è®­åç§°</h3>
                                <div class="inline-block bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm font-medium">
                                    09:00 - 11:00
                                </div>
                            </div>
                            
                            <div class="bg-white p-4 rounded-xl shadow-sm border border-gray-100 mb-auto">
                                <div class="flex justify-between mb-2">
                                    <span class="text-gray-500">è®²å¸ˆ</span>
                                    <span class="font-medium">èµµå…­</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-500">åœ°ç‚¹</span>
                                    <span class="font-medium">å¤§ä¼šè®®å®¤</span>
                                </div>
                            </div>

                            <button onclick="app.mobileDoSign()" class="btn btn-primary w-full py-4 text-lg shadow-lg mt-4">
                                ç¡®è®¤ç­¾åˆ°
                            </button>
                        </div>

                        <!-- Step 3: Success -->
                        <div id="ms-step-success" class="hidden flex flex-col items-center justify-center h-full text-center">
                            <div class="w-20 h-20 bg-green-100 rounded-full flex items-center justify-center mb-6 text-green-600">
                                <svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><polyline points="20 6 9 17 4 12"></polyline></svg>
                            </div>
                            <h3 class="text-2xl font-bold text-gray-800 mb-2">ç­¾åˆ°æˆåŠŸ</h3>
                            <p class="text-gray-500 mb-8" id="ms-success-time">æ—¶é—´: 08:55:20</p>
                            <button onclick="router.go('employee-home')" class="btn btn-secondary w-full">è¿”å›é¦–é¡µ</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- View: RAG -->
        <div id="view-rag" class="hidden">
            <h2 class="text-xl mb-4">æ™ºèƒ½é—®ç­”åŠ©æ‰‹</h2>
            <div class="grid-2" style="grid-template-columns: 1fr 300px;">
                <div class="chat-box">
                    <div id="chat-msgs" class="chat-msgs">
                        <div class="msg bot">ä½ å¥½ï¼æˆ‘æ˜¯ä½ çš„è€ƒå‹¤åŠ©æ‰‹ï¼Œæœ‰é—®é¢˜è¯·éšæ—¶é—®æˆ‘ã€‚ä¾‹å¦‚ï¼šâ€œè¿Ÿåˆ°æ€ä¹ˆç®—ï¼Ÿâ€</div>
                    </div>
                    <div class="chat-input">
                        <input type="text" id="chat-input" class="input" placeholder="è¾“å…¥é—®é¢˜..." onkeypress="if(event.key==='Enter') app.sendChat()">
                        <button onclick="app.sendChat()" class="btn btn-primary">å‘é€</button>
                    </div>
                </div>
                <div class="card h-full">
                    <h3 class="text-lg mb-4">å‚è€ƒæ–‡æ¡£</h3>
                    <ul class="text-sm text-secondary space-y-2" style="list-style: none;">
                        <li class="flex items-center gap-2 p-2 hover:bg-gray-50 rounded cursor-pointer">
                            ğŸ“„ å‘˜å·¥è€ƒå‹¤ç®¡ç†åˆ¶åº¦.pdf
                        </li>
                        <li class="flex items-center gap-2 p-2 hover:bg-gray-50 rounded cursor-pointer">
                            ğŸ“„ åŸ¹è®­ç§¯åˆ†ç®¡ç†åŠæ³•.docx
                        </li>
                    </ul>
                </div>
            </div>
        </div>

    </div> <!-- End Main Container -->

    <!-- Modal: Create User -->
    <div id="modal-user" class="modal-overlay">
        <div class="modal">
            <div class="modal-header">æ–°å»ºç”¨æˆ·</div>
            <div class="flex flex-col gap-4">
                <div>
                    <label class="text-sm font-bold block mb-1">å§“å</label>
                    <input type="text" id="mu-name" class="input">
                </div>
                <div>
                    <label class="text-sm font-bold block mb-1">å·¥å·</label>
                    <input type="text" id="mu-id" class="input">
                </div>
                <div>
                    <label class="text-sm font-bold block mb-1">éƒ¨é—¨</label>
                    <select id="mu-dept" class="input">
                        <option>ç ”å‘éƒ¨</option>
                        <option>å¸‚åœºéƒ¨</option>
                        <option>äººäº‹éƒ¨</option>
                        <option>è´¢åŠ¡éƒ¨</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button onclick="app.closeUserModal()" class="btn btn-secondary">å–æ¶ˆ</button>
                <button onclick="app.saveUser()" class="btn btn-primary">ä¿å­˜</button>
            </div>
        </div>
    </div>

    <!-- Modal: Confirm Dialog -->
    <div id="modal-confirm" class="modal-overlay">
        <div class="modal" style="max-width: 400px;">
            <h3 class="text-lg font-bold mb-2" id="mc-title">ç¡®è®¤æ“ä½œ</h3>
            <p class="text-secondary mb-6" id="mc-text">ç¡®å®šè¦æ‰§è¡Œæ­¤æ“ä½œå—ï¼Ÿ</p>
            <div class="modal-footer">
                <button onclick="ui.closeConfirm()" class="btn btn-secondary">å–æ¶ˆ</button>
                <button id="mc-btn-ok" class="btn btn-primary">ç¡®å®š</button>
            </div>
        </div>
    </div>

    <script>
        // --- Data ---
        const db = {
            users: [
                { id: 'admin', name: 'ç®¡ç†å‘˜', role: 'admin', dept: 'ç®¡ç†éƒ¨' },
                { id: 'emp001', name: 'å¼ ä¸‰', role: 'employee', dept: 'ç ”å‘éƒ¨' },
                { id: 'emp002', name: 'æå››', role: 'employee', dept: 'å¸‚åœºéƒ¨' },
            ],
            trainings: [
                { id: 1, title: '2025å¹´Q1å…¨å‘˜å®‰å…¨æ„è¯†åŸ¹è®­', time: '2025-01-15 14:00', status: 'è¿›è¡Œä¸­', trainer: 'èµµå…­', limit: 100, applied: 45 },
                { id: 2, title: 'é«˜çº§æ¶æ„è®¾è®¡å®æˆ˜', time: '2025-02-20 09:30', status: 'æŠ¥åä¸­', trainer: 'é’±ä¸ƒ', limit: 30, applied: 12 },
                { id: 3, title: 'å•†åŠ¡ç¤¼ä»ªä¸æ²Ÿé€š', time: '2024-12-10 10:00', status: 'å·²ç»“æŸ', trainer: 'å¤–éƒ¨è®²å¸ˆ', limit: 50, applied: 50 },
            ],
            myTrainings: [] // [id, id]
        };

        let currentUser = null;

        // --- UI Utils ---
        const ui = {
            toast: (msg, type = 'success') => {
                const container = document.getElementById('toast-container');
                const el = document.createElement('div');
                el.className = `toast ${type}`;
                el.innerHTML = `<span>${type === 'success' ? 'âœ…' : 'âš ï¸'} ${msg}</span>`;
                container.appendChild(el);
                setTimeout(() => {
                    el.style.opacity = '0';
                    el.style.transform = 'translateX(100%)';
                    setTimeout(() => el.remove(), 300);
                }, 3000);
            },
            
            confirm: (title, text, onConfirm) => {
                document.getElementById('mc-title').innerText = title;
                document.getElementById('mc-text').innerText = text;
                const okBtn = document.getElementById('mc-btn-ok');
                okBtn.onclick = () => {
                    onConfirm();
                    ui.closeConfirm();
                };
                document.getElementById('modal-confirm').classList.add('active');
            },

            closeConfirm: () => {
                document.getElementById('modal-confirm').classList.remove('active');
            }
        };

        // --- Router ---
        const router = {
            current: 'view-login',
            history: [],
            go: (viewId) => {
                document.getElementById(router.current).classList.add('hidden');
                document.getElementById('view-' + viewId).classList.remove('hidden');
                
                if (viewId !== 'login' && viewId !== router.current) {
                    router.history.push(router.current);
                }
                router.current = 'view-' + viewId;

                // Refresh Logic
                if (viewId === 'admin-home') app.renderAdminHome();
                if (viewId === 'user-mgmt') app.renderUserList();
                if (viewId === 'training-mgmt') app.renderTrainingList();
                if (viewId === 'employee-home') app.renderEmployeeHome();
                if (viewId === 'mobile-signin') app.initMobile();
                if (viewId === 'training-detail') app.renderTrainingDetail();
            },
            back: () => {
                if (router.history.length) {
                    const prev = router.history.pop();
                    document.getElementById(router.current).classList.add('hidden');
                    document.getElementById(prev).classList.remove('hidden');
                    router.current = prev;
                }
            }
        };

        // --- Auth ---
        const auth = {
            login: () => {
                const id = document.getElementById('login-id').value;
                const user = db.users.find(u => u.id === id);
                if (!user) return ui.toast('ç”¨æˆ·ä¸å­˜åœ¨', 'error');

                currentUser = user;
                document.getElementById('view-login').classList.add('hidden');
                document.getElementById('main-header').classList.remove('hidden');
                
                document.getElementById('user-name-display').innerText = user.name;
                document.getElementById('user-role-display').innerText = user.role === 'admin' ? 'ç®¡ç†å‘˜' : 'å‘˜å·¥';

                if (user.role === 'admin') {
                    document.getElementById('admin-nav').classList.remove('hidden');
                    document.getElementById('employee-nav').classList.add('hidden');
                    router.go('admin-home');
                } else {
                    document.getElementById('admin-nav').classList.add('hidden');
                    document.getElementById('employee-nav').classList.remove('hidden');
                    router.go('employee-home');
                }
                ui.toast(`æ¬¢è¿å›æ¥ï¼Œ${user.name}`);
            },
            logout: () => {
                currentUser = null;
                location.reload(); // Simple reset
            }
        };

        // --- App Logic ---
        const app = {
            // Admin Home
            renderAdminHome: () => {
                const list = db.trainings.slice(0, 3);
                document.getElementById('home-recent-list').innerHTML = list.map(t => `
                    <tr>
                        <td class="font-bold text-main">${t.title}</td>
                        <td class="text-secondary">${t.time.split(' ')[0]}</td>
                        <td><span class="tag ${getStatusColor(t.status)}">${t.status}</span></td>
                    </tr>
                `).join('');
            },

            // User Management
            renderUserList: () => {
                document.getElementById('user-table-body').innerHTML = db.users.map(u => `
                    <tr>
                        <td class="font-bold">${u.name}</td>
                        <td class="text-secondary">${u.id}</td>
                        <td>${u.dept}</td>
                        <td><span class="tag tag-green">å¯ç”¨</span></td>
                        <td style="text-align: right;">
                            <button class="btn btn-secondary btn-sm" onclick="ui.toast('åŠŸèƒ½å¼€å‘ä¸­', 'warning')">ç¼–è¾‘</button>
                            <button class="btn btn-danger btn-sm" onclick="app.deleteUser('${u.id}')">åˆ é™¤</button>
                        </td>
                    </tr>
                `).join('');
            },
            openUserModal: () => {
                document.getElementById('mu-name').value = '';
                document.getElementById('mu-id').value = '';
                document.getElementById('modal-user').classList.add('active');
            },
            closeUserModal: () => {
                document.getElementById('modal-user').classList.remove('active');
            },
            saveUser: () => {
                const name = document.getElementById('mu-name').value;
                const id = document.getElementById('mu-id').value;
                const dept = document.getElementById('mu-dept').value;
                
                if (!name || !id) return ui.toast('è¯·å¡«å†™å®Œæ•´ä¿¡æ¯', 'error');
                
                db.users.push({ id, name, dept, role: 'employee' });
                app.closeUserModal();
                app.renderUserList();
                ui.toast('ç”¨æˆ·åˆ›å»ºæˆåŠŸ');
            },
            deleteUser: (id) => {
                if (id === 'admin') return ui.toast('æ— æ³•åˆ é™¤ç®¡ç†å‘˜', 'error');
                ui.confirm('åˆ é™¤ç”¨æˆ·', 'ç¡®å®šè¦åˆ é™¤è¯¥ç”¨æˆ·å—ï¼Ÿæ­¤æ“ä½œæ— æ³•æ’¤é”€ã€‚', () => {
                    db.users = db.users.filter(u => u.id !== id);
                    app.renderUserList();
                    ui.toast('ç”¨æˆ·å·²åˆ é™¤');
                });
            },

            // Training Management
            renderTrainingList: () => {
                document.getElementById('training-table-body').innerHTML = db.trainings.map(t => `
                    <tr>
                        <td class="font-bold">${t.title}</td>
                        <td class="text-secondary">${t.time}</td>
                        <td>${t.trainer}</td>
                        <td>${t.applied} / ${t.limit}</td>
                        <td><span class="tag ${getStatusColor(t.status)}">${t.status}</span></td>
                        <td style="text-align: right;">
                             <button class="btn btn-secondary btn-sm" onclick="app.viewTrainingDetail(${t.id})">è¯¦æƒ…</button>
                        </td>
                    </tr>
                `).join('');
            },
            viewTrainingDetail: (id) => {
                app.currentTrainingId = id;
                router.go('training-detail');
            },
            renderTrainingDetail: () => {
                const id = app.currentTrainingId;
                const t = db.trainings.find(x => x.id === id);
                if (!t) return;

                document.getElementById('td-title').innerText = t.title;
                document.getElementById('td-trainer').innerText = t.trainer;
                document.getElementById('td-time').innerText = t.time;
                document.getElementById('td-status').innerHTML = t.status;
                document.getElementById('td-status').className = `tag ${getStatusColor(t.status)}`;
                document.getElementById('td-desc').innerText = 'è¿™é‡Œæ˜¯åŸ¹è®­çš„è¯¦ç»†ä»‹ç»å†…å®¹ï¼ŒåŒ…å«è¯¾ç¨‹å¤§çº²ã€æ³¨æ„äº‹é¡¹ç­‰...';
                document.getElementById('td-location').innerText = '305ä¼šè®®å®¤'; // Mock data

                // Mock Stats
                const applied = t.applied;
                const signed = Math.floor(applied * 0.9);
                const late = Math.floor(signed * 0.1);
                
                document.getElementById('td-stat-applied').innerText = applied;
                document.getElementById('td-stat-signed').innerText = signed;
                document.getElementById('td-stat-late').innerText = late;
                document.getElementById('td-stat-rate').innerText = applied > 0 ? Math.floor((signed / applied) * 100) + '%' : '0%';

                // Mock Student List
                const depts = ['ç ”å‘éƒ¨', 'å¸‚åœºéƒ¨', 'äººäº‹éƒ¨', 'è´¢åŠ¡éƒ¨'];
                const names = ['å¼ ä¸‰', 'æå››', 'ç‹äº”', 'èµµå…­', 'å­™ä¸ƒ', 'å‘¨å…«'];
                let rows = '';
                for(let i=0; i<applied; i++) {
                    const name = names[i % names.length] + (i+1);
                    const dept = depts[i % depts.length];
                    const isSigned = i < signed;
                    const isLate = i < late;
                    const status = isSigned ? (isLate ? '<span class="text-orange-500">è¿Ÿåˆ°</span>' : '<span class="text-green-600">æ­£å¸¸</span>') : '<span class="text-gray-400">æœªç­¾åˆ°</span>';
                    
                    rows += `
                        <tr>
                            <td>${name}</td>
                            <td>${dept}</td>
                            <td class="text-secondary">2025-01-10 10:00</td>
                            <td class="text-secondary">${isSigned ? '08:55:00' : '-'}</td>
                            <td>${status}</td>
                        </tr>
                    `;
                }
                document.getElementById('td-student-list').innerHTML = rows;
            },
            saveTraining: () => {
                const title = document.getElementById('tf-title').value;
                if (!title) return ui.toast('è¯·è¾“å…¥åŸ¹è®­åç§°', 'error');
                
                db.trainings.unshift({
                    id: Date.now(),
                    title: title,
                    time: document.getElementById('tf-start').value.replace('T', ' ') || '2025-05-01 09:00',
                    status: 'æŠ¥åä¸­',
                    trainer: document.getElementById('tf-trainer').value || 'æœªå®š',
                    limit: 50,
                    applied: 0
                });
                ui.toast('å‘å¸ƒæˆåŠŸ');
                router.go('training-mgmt');
            },

            // Employee Logic
            renderEmployeeHome: () => {
                const my = db.trainings.filter(t => db.myTrainings.includes(t.id));
                const available = db.trainings.filter(t => !db.myTrainings.includes(t.id) && t.status === 'æŠ¥åä¸­');

                document.getElementById('emp-todo-list').innerHTML = my.length ? my.map(t => `
                    <div class="card p-4 flex justify-between items-center border-l-4 border-l-blue-500">
                        <div>
                            <div class="font-bold text-lg">${t.title}</div>
                            <div class="text-sm text-secondary">â° ${t.time} | ğŸ‘¤ ${t.trainer}</div>
                        </div>
                        <span class="tag ${getStatusColor(t.status)}">${t.status}</span>
                    </div>
                `).join('') : '<div class="text-center text-secondary py-4">æš‚æ— å¾…å‚åŠ çš„åŸ¹è®­</div>';

                document.getElementById('emp-available-list').innerHTML = available.length ? available.map(t => `
                    <div class="card p-4 flex flex-col justify-between h-full">
                        <div class="mb-4">
                            <div class="font-bold text-lg mb-2">${t.title}</div>
                            <div class="text-sm text-secondary">â° ${t.time}</div>
                            <div class="text-sm text-secondary">ğŸ“ åœ°ç‚¹å¾…å®š</div>
                        </div>
                        <button onclick="app.applyTraining(${t.id})" class="btn btn-secondary w-full">ç«‹å³æŠ¥å</button>
                    </div>
                `).join('') : '<div class="col-span-2 text-center text-secondary">æš‚æ— æ–°åŸ¹è®­</div>';
            },
            applyTraining: (id) => {
                ui.confirm('ç¡®è®¤æŠ¥å', 'ç¡®å®šè¦æŠ¥åå‚åŠ è¯¥åŸ¹è®­å—ï¼Ÿ', () => {
                    db.myTrainings.push(id);
                    app.renderEmployeeHome();
                    ui.toast('æŠ¥åæˆåŠŸï¼è¯·å‡†æ—¶å‚åŠ ');
                });
            },

            // Mobile Sign In
            initMobile: () => {
                document.getElementById('ms-step-scan').classList.remove('hidden');
                document.getElementById('ms-step-confirm').classList.add('hidden');
                document.getElementById('ms-step-success').classList.add('hidden');
            },
            mobileScanSuccess: () => {
                document.getElementById('ms-step-scan').classList.add('hidden');
                document.getElementById('ms-step-confirm').classList.remove('hidden');
            },
            mobileDoSign: () => {
                document.getElementById('ms-step-confirm').classList.add('hidden');
                document.getElementById('ms-step-success').classList.remove('hidden');
                document.getElementById('ms-success-time').innerText = 'æ—¶é—´: ' + new Date().toLocaleTimeString();
            },

            // Chat
            sendChat: () => {
                const input = document.getElementById('chat-input');
                const text = input.value.trim();
                if (!text) return;
                
                const box = document.getElementById('chat-msgs');
                box.innerHTML += `<div class="msg user">${text}</div>`;
                input.value = '';
                box.scrollTop = box.scrollHeight;

                setTimeout(() => {
                    let reply = "è¿™ä¸ªé—®é¢˜æˆ‘è¿˜åœ¨å­¦ä¹ ä¸­...";
                    if (text.includes('å‡')) reply = "æ ¹æ®è€ƒå‹¤åˆ¶åº¦ï¼Œäº‹å‡éœ€æå‰1å¤©ç”³è¯·ï¼Œç—…å‡éœ€æä¾›åŒ»ç”Ÿè¯æ˜ã€‚";
                    if (text.includes('è¿Ÿåˆ°')) reply = "åŸ¹è®­è¿Ÿåˆ°15åˆ†é’Ÿä»¥ä¸Šå°†è®°å½•ä¸ºç¼ºå‹¤ï¼Œå½±å“å­£åº¦ç»©æ•ˆã€‚";
                    box.innerHTML += `<div class="msg bot">${reply}</div>`;
                    box.scrollTop = box.scrollHeight;
                }, 800);
            }
        };

        function getStatusColor(status) {
            if (status === 'è¿›è¡Œä¸­') return 'tag-green';
            if (status === 'æŠ¥åä¸­') return 'tag-blue';
            return 'tag-gray';
        }

    </script>
</body>
</html>
